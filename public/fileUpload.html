<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>File Upload Challenge</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --danger: #f72585;
      --success: #4cc9f0;
      --dark-bg: #0f172a;
      --card-bg: #1e293b;
    }
    body {
      background: var(--dark-bg);
      font-family: 'Poppins', sans-serif;
      padding: 2rem;
    }
    .upload-area {
      border: 2px dashed #4895ef;
      padding: 2rem;
      text-align: center;
      margin: 1rem 0;
    }
    #uploadResult {
      background: #334155;
      padding: 1rem;
      margin-top: 1rem;
      border-radius: 5px;
    }
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 10px;
      max-width: 500px;
    }
  </style>
</head>
<body>

<div class="playground">
  <h1>File Upload Challenge</h1>
  <div class="upload-area" id="uploadArea">
    <p>Drag & drop your file here</p>
    <input type="file" id="fileInput">
  </div>
  <button id="uploadBtn">Upload</button>
  
  <div id="uploadResult"></div>
  
  <div class="actions">
    <button id="hintBtn">Hint</button>
    <button id="solutionBtn">Solution</button>
  </div>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="modalTitle"></h3>
    <p id="modalText"></p>
    <button id="closeModal">Close</button>
  </div>
</div>

<script>
// DOM Elements
const fileInput = document.getElementById('fileInput');
const uploadBtn = document.getElementById('uploadBtn');
const uploadResult = document.getElementById('uploadResult');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalText = document.getElementById('modalText');

// Upload handler
uploadBtn.addEventListener('click', async () => {
  const file = fileInput.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    const content = e.target.result;
    const analysis = analyzeFile(content, file.name);
    
    uploadResult.innerHTML = `
      <div>Filename: ${file.name}</div>
      <div>Type: ${file.type || 'Unknown'}</div>
      <div style="color:${analysis.isMalicious ? 'var(--danger)' : 'var(--success)'}">
        ${analysis.message}
      </div>
    `;
    
    if (analysis.isMalicious) {
      setTimeout(() => {
        showSuccess(analysis.type);
      }, 1000);
    }
  };
  reader.readAsText(file);
});

// File analysis - THIS IS WHAT CHECKS YOUR UPLOADED FILES
function analyzeFile(content, filename) {
  // These patterns will trigger success
  const patterns = {
    php: /<\?php[\s\S]*?\?>/i,
    xss: /XSS Success!/i,
    system: /system\(['"].*['"]\)/i,
    image: /GIF89a;.*<\?php/i
  };

  if (patterns.xss.test(content)) {
    return {
      isMalicious: true,
      message: "⚠️ XSS payload detected!",
      type: "xss"
    };
  }
  if (patterns.php.test(content)) {
    return {
      isMalicious: true,
      message: "⚠️ PHP code detected!",
      type: "php"
    };
  }
  if (patterns.system.test(content)) {
    return {
      isMalicious: true,
      message: "⚠️ System commands detected!",
      type: "system"
    };
  }
  if (patterns.image.test(content)) {
    return {
      isMalicious: true,
      message: "⚠️ PHP in image detected!",
      type: "image"
    };
  }

  return {
    isMalicious: false,
    message: "✓ File appears safe",
    type: "safe"
  };
}

// This shows the success modal
function showSuccess(type) {
  modalTitle.textContent = "Challenge Solved!";
  modalText.textContent = `You successfully uploaded ${type} code! (10 points)`;
  modal.style.display = "flex";
}

// Modal controls
document.getElementById('closeModal').addEventListener('click', () => {
  modal.style.display = "none";
});

// Hint and Solution buttons
document.getElementById('hintBtn').addEventListener('click', () => {
  modalTitle.textContent = "Hint";
  modalText.innerHTML = "Try uploading a file containing:<br><br>" +
    "1. PHP code between &lt;?php ?&gt; tags<br>" +
    "2. The exact text 'XSS Success!'<br>" +
    "3. System commands like system('whoami')";
  modal.style.display = "flex";
});

document.getElementById('solutionBtn').addEventListener('click', () => {
  modalTitle.textContent = "Solution";
  modalText.innerHTML = `<strong>Working payload:</strong>
    <pre>GIF89a;
&lt;?php
/*
XSS Success!
*/
echo "Exploit worked!";
?&gt;</pre>
    <p>Save this as "exploit.gif.php" and upload it</p>`;
  modal.style.display = "flex";
});
</script>
</body>
</html>